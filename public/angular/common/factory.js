// Generated by CoffeeScript 1.8.0
(function() {
  app.factory('Page', [
    '$rootScope', '$http', '$window', function($rootScope, $http, $window) {
      var Page;
      console.log('Bitch! Dis aint real!');
      return new (Page = (function() {
        function Page() {
          this.timestamp = Date.now();
          this.failureAttempts = 0;
          this.pageData = null;
          this.fetchPageData();
        }

        Page.prototype.fetchPageData = function(pageName) {
          var request;
          request = $http.get('/templates/page-data');
          return request.then((function(_this) {
            return function(result) {
              _this.pageData = result.data;
              if (_this.pageData.Status === false && _this.failureAttempts < 5) {
                console.warn('Could not load page data from server ... Refetching data ...');
                _this.failureAttempts += 1;
                _this.fetchPageData();
              } else if (_this.pageData.Status === false && _this.failureAttempts >= 5) {
                console.error('Failed permanently ... Reloading page now ...');
                $window.location = '/';
              }
              if (typeof pageName !== 'undefined') {
                return _this.setPageHeaders(pageName);
              }
            };
          })(this));
        };

        Page.prototype.setPageHeaders = function(page) {
          if (typeof this.pageData === "undefined" || this.pageData === null) {
            if (this.failureAttempts < 5) {
              this.failureAttempts += 1;
              this.fetchPageData(page);
            }
            return;
          }
          return angular.forEach(this.pageData.Pages, function(pd, index) {
            if (pd.Index === page) {
              $rootScope.title = pd.Title;
              $rootScope.metaDescription = pd.Description;
              return $rootScope.metaKeywords = pd.Keywords;
            }
          });
        };

        return Page;

      })());
    }
  ]);

}).call(this);
